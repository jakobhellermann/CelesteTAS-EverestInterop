using HarmonyLib;
using System.Collections.Generic;
using StudioCommunication;
using System.Diagnostics.CodeAnalysis;
using TAS.Utils;
using UnityEngine;
using Random = UnityEngine.Random;

namespace TAS.Input.Commands;

[HarmonyPatch]
[SuppressMessage("Method Declaration", "Harmony003:Harmony non-ref patch parameters modified")]
public static class LoadCommand {
    private static Dictionary<string, string[]> sceneTransitions = new() {
        { "Pre_Menu_Intro", [] },
        { "Menu_Title", [] },
        { "Quit_To_Menu", [] },
        { "BetaEnd", [] },
        { "Knight_Pickup", [] },
        { "Opening_Sequence", [] },
        { "Tutorial_01", ["right1", "top1", "top2"] }, {
            "Town",
            [
                "door_jiji", "bot1", "door_mapper", "door_station", "door_sly", "room_divine", "room_grimm",
                "door_bretta", "left1", "top1", "door_dreamReturn", "right1",
            ]
        },
        { "Cinematic_Stag_travel", [] },
        { "Room_Town_Stag_Station", ["left1", "door_stagExit"] },
        { "Room_Charm_Shop", ["left1"] },
        { "Room_Mender_House", ["left1"] },
        { "Room_mapper", ["left1"] },
        { "Room_nailmaster", ["left1"] },
        { "Room_nailmaster_02", ["left1"] },
        { "Room_nailmaster_03", ["left1"] },
        { "Room_nailsmith", ["left1"] },
        { "Room_shop", ["door1", "left1"] },
        { "Room_Sly_Storeroom", ["top1", "door1"] },
        { "Room_temple", ["door1", "left1"] },
        { "Room_ruinhouse", ["left1"] },
        { "Room_Mask_Maker", ["right1"] },
        { "Room_Mansion", ["left1"] },
        { "Room_Tram", ["door1"] },
        { "Room_Tram_RG", ["door1"] },
        { "Room_Bretta", ["right1", "door1"] },
        { "Room_Bretta_Basement", ["door1", "door_dreamReturn", "top1"] },
        { "Room_Fungus_Shaman", ["left1"] },
        { "Room_Ouiji", ["left1"] },
        { "Room_Jinn", ["left1"] },
        { "Room_Colosseum_01", ["right1", "bot1", "left1"] },
        { "Room_Colosseum_02", ["top2", "top1"] },
        { "Room_Colosseum_Bronze", ["left1", "left1 (1)"] },
        { "Room_Colosseum_Silver", ["left1", "left1 (1)"] },
        { "Room_Colosseum_Gold", ["left1", "left1 (1)"] },
        { "Room_Colosseum_Spectate", ["bot1", "right1"] },
        { "Room_Slug_Shrine", ["left1"] },
        { "Crossroads_01", ["door1", "top1", "top2", "right1", "left1"] },
        { "Crossroads_02", ["left1", "right1", "door1"] },
        { "Crossroads_03", ["left1", "top1", "right2", "bot1", "left2", "right1"] },
        { "Crossroads_04", ["right1", "door1", "top1", "door_charmshop", "left1", "door_Mender_House"] },
        { "Crossroads_05", ["left1", "right1"] },
        { "Crossroads_06", ["right1", "door1", "left1"] },
        { "Crossroads_07", ["left3", "right2", "left2", "bot1", "right1", "left1"] },
        { "Crossroads_08", ["left2", "right2", "right1", "left1"] },
        { "Crossroads_09", ["right1", "left1"] },
        { "Crossroads_10", ["door_dreamReturn", "left1", "right1"] },
        { "Crossroads_10_preload", [] },
        { "Crossroads_10_boss", [] },
        { "Crossroads_10_boss_defeated", [] },
        { "Crossroads_11_alt", ["left1", "right1"] },
        { "Crossroads_12", ["right1", "left1"] },
        { "Crossroads_13", ["left1", "right1"] },
        { "Crossroads_14", ["left2", "left1", "right1", "right2"] },
        { "Crossroads_15", ["right1", "left1"] },
        { "Crossroads_16", ["left1", "right1", "bot1"] },
        { "Crossroads_18", ["right2", "right1", "bot1"] },
        { "Crossroads_19", ["right1", "top1", "left2", "left1"] },
        { "Crossroads_21", ["top1", "left1", "top2", "right1"] },
        { "Crossroads_22", ["bot1"] },
        { "Crossroads_25", ["left1", "right1"] },
        { "Crossroads_27", ["right1", "bot1", "left1", "left2"] },
        { "Crossroads_30", ["left1"] },
        { "Crossroads_31", ["right1"] },
        { "Crossroads_33", ["right2", "left2", "right1", "top1", "left1"] },
        { "Crossroads_35", ["bot1", "right1"] },
        { "Crossroads_36", ["right1", "right2"] },
        { "Crossroads_37", ["right1"] },
        { "Crossroads_38", ["right1"] },
        { "Crossroads_39", ["right1", "left1"] },
        { "Crossroads_40", ["right1", "left1"] },
        { "Crossroads_42", ["right1", "left1"] },
        { "Crossroads_43", ["right1", "left1"] },
        { "Crossroads_45", ["right1", "left1"] },
        { "Crossroads_46", ["left1", "door_tram"] },
        { "Crossroads_46b", ["right1", "door_tram"] },
        { "Crossroads_ShamanTemple", ["left1"] },
        { "Crossroads_47", ["door_stagExit", "right1"] },
        { "Crossroads_48", ["left1"] },
        { "Crossroads_49", ["left1", "elev_entrance", "right1"] },
        { "Crossroads_49b", ["left1", "right1", "elev_entrance"] },
        { "Crossroads_50", ["left1", "right1"] },
        { "Crossroads_52", ["left1"] },
        { "Ruins_House_01", ["left1"] },
        { "Ruins_House_02", ["left1"] },
        { "Ruins_House_03", ["left2", "left1"] },
        { "Ruins_Elevator", ["left1", "left2"] },
        { "Ruins_Bathhouse", ["door1", "right1"] },
        { "Ruins1_01", ["top1", "left1", "bot1"] },
        { "Ruins1_02", ["top1", "bot1"] },
        { "Ruins1_03", ["right1", "right2", "top1", "left1"] },
        { "Ruins1_04", ["bot1", "door1", "right1"] },
        { "Ruins1_05", ["right2", "bot2", "bot3", "right1", "top1", "bot1"] },
        { "Ruins1_05b", ["right1", "bot1", "left1", "top1"] },
        { "Ruins1_05c", ["top3", "top1", "left2", "top2", "bot1"] },
        { "Ruins1_06", ["left1", "right1"] },
        { "Ruins1_09", ["left1", "top1"] },
        { "Ruins1_17", ["bot1", "top1", "right1"] },
        { "Ruins1_18", ["left1", "right1", "right2"] },
        { "Ruins1_23", ["bot1", "right1", "top1", "right2", "left1"] },
        { "Ruins1_30", ["left2", "bot1", "left1", "right1"] },
        { "Ruins1_24", ["left1", "door_dreamReturn", "left2", "right1", "right2"] },
        { "Ruins1_24_boss", [] },
        { "Ruins1_24_boss_defeated", [] },
        { "Ruins1_25", ["left1", "left3", "left2"] },
        { "Ruins1_27", ["right1", "left1"] },
        { "Ruins1_28", ["right1", "left1", "bot1"] },
        { "Ruins1_29", ["left1", "door_stagExit"] },
        { "Ruins1_31", ["left3", "bot1", "left1", "left2", "right1"] },
        { "Ruins1_31b", ["right1", "right2"] },
        { "Ruins1_32", ["right2", "right1"] },
        { "Ruins2_01", ["top1", "bot1", "left2"] },
        { "Ruins2_01_b", ["right1", "top1", "left1"] },
        { "Ruins2_03", ["bot1", "top1", "bot2"] },
        { "Ruins2_03b", ["top1", "top2", "bot1", "left1"] },
        { "Ruins2_03_boss", [] }, {
            "Ruins2_04",
            [
                "left2", "right1", "door_Ruin_House_03", "right2", "door_Ruin_Elevator", "left1", "door_Ruin_House_01",
                "door_Ruin_House_02",
            ]
        },
        { "Ruins2_05", ["top1", "left1", "bot1"] },
        { "Ruins2_06", ["right2", "right1", "left2", "left1", "top1"] },
        { "Ruins2_07", ["right1", "left1", "top1"] },
        { "Ruins2_08", ["door_stagExit", "left1"] },
        { "Ruins2_09", ["bot1"] },
        { "Ruins2_10", ["elev_entrance", "left1", "right1"] },
        { "Ruins2_10b", ["left1", "right1", "elev_entrance", "right2"] },
        { "Ruins2_11", ["right1"] },
        { "Ruins2_11_b", ["left1", "bot1", "right1"] },
        { "Ruins2_11_boss", [] },
        { "Ruins2_Watcher_Room", ["door_dreamReturn", "bot1"] },
        { "Fungus1_01", ["left1", "right1"] },
        { "Fungus1_01b", ["left1", "right1"] },
        { "Fungus1_02", ["right1", "right2", "left1"] },
        { "Fungus1_03", ["bot1", "right1", "left1"] },
        { "Fungus1_04", ["right1", "left1"] },
        { "Fungus1_04_boss", [] },
        { "Fungus1_05", ["right1", "bot1", "top1"] },
        { "Fungus1_06", ["bot1", "left1"] },
        { "Fungus1_07", ["right1", "top1", "left1"] },
        { "Fungus1_08", ["left1"] },
        { "Fungus1_09", ["right1", "left1"] },
        { "Fungus1_10", ["right1", "top1", "left1"] },
        { "Fungus1_11", ["left1", "bot1", "top1", "right2", "right1"] },
        { "Fungus1_12", ["right1", "left1"] },
        { "Fungus1_13", ["right1", "left1"] },
        { "Fungus1_14", ["left1"] },
        { "Fungus1_15", ["door1", "right1"] },
        { "Fungus1_16_alt", ["right1", "door_stagExit"] },
        { "Fungus1_17", ["right1", "left1"] },
        { "Fungus1_19", ["bot1", "right1", "left1"] },
        { "Fungus1_20_v02", ["right1", "bot2", "bot1"] },
        { "Fungus1_21", ["top1", "right1", "bot1", "left1"] },
        { "Fungus1_22", ["left1", "top1", "bot1"] },
        { "Fungus1_23", ["right1", "left1"] },
        { "Fungus1_24", ["left1"] },
        { "Fungus1_25", ["right1", "left1"] },
        { "Fungus1_26", ["door_SlugShrine", "right1", "left1"] },
        { "Fungus1_28", ["left1", "left2"] },
        { "Fungus1_29", ["right1", "left1"] },
        { "Fungus1_30", ["right1", "top3", "left1", "top1"] },
        { "Fungus1_31", ["top1", "bot1", "right1"] },
        { "Fungus1_32", ["top1", "left1", "bot1"] },
        { "Fungus1_34", ["left1", "door1"] },
        { "Fungus1_35", ["right1", "left1"] },
        { "Fungus1_36", ["left1"] },
        { "Fungus1_37", ["left1"] },
        { "Fungus1_Slug", ["right1"] },
        { "Fungus2_01", ["right1", "left2", "left1", "left3"] },
        { "Fungus2_02", ["door_stagExit", "right1"] },
        { "Fungus2_03", ["left1", "bot1", "right1"] },
        { "Fungus2_04", ["right2", "top1", "right1", "left1"] },
        { "Fungus2_05", ["right1", "bot1"] },
        { "Fungus2_06", ["top1", "left2", "left1", "right1", "right2"] },
        { "Fungus2_07", ["left1", "right1"] },
        { "Fungus2_08", ["left1", "right1", "left2"] },
        { "Fungus2_09", ["left1", "right1"] },
        { "Fungus2_10", ["right2", "bot1", "right1"] },
        { "Fungus2_11", ["top1", "left1", "left2", "right1"] },
        { "Fungus2_12", ["left1", "bot1"] },
        { "Fungus2_13", ["left2", "top1", "left3"] },
        { "Fungus2_14", ["bot3", "top1", "bot2", "bot1", "right1"] },
        { "Fungus2_15", ["left1", "top2", "right1", "top3", "top1"] },
        { "Fungus2_15_boss", [] },
        { "Fungus2_15_boss_defeated", [] },
        { "Fungus2_17", ["bot1", "left1", "right1"] },
        { "Fungus2_18", ["top1", "right1", "bot1"] },
        { "Fungus2_19", ["top1", "left1"] },
        { "Fungus2_20", ["right1", "left1"] },
        { "Fungus2_21", ["right1", "left1"] },
        { "Fungus2_23", ["right1", "right2"] },
        { "Fungus2_25", ["top1", "right1 (1)", "right1", "top2"] },
        { "Fungus2_26", ["left1"] },
        { "Fungus2_28", ["left2", "left1"] },
        { "Fungus2_29", ["bot1", "right1"] },
        { "Fungus2_30", ["bot1", "top1"] },
        { "Fungus2_31", ["left1"] },
        { "Fungus2_32", ["left1"] },
        { "Fungus2_33", ["right1", "left1"] },
        { "Fungus2_34", ["right1"] },
        { "Fungus3_01", ["right2", "left1", "right1", "top1"] },
        { "Fungus3_02", ["left3", "left1", "left2", "right1", "right2"] },
        { "Fungus3_03", ["left1", "right1"] },
        { "Fungus3_04", ["left2", "right2", "right1", "left1"] },
        { "Fungus3_05", ["right1", "left1", "right2"] },
        { "Fungus3_08", ["right1", "left1", "top1"] },
        { "Fungus3_10", ["bot1", "top1"] },
        { "Fungus3_11", ["right1", "left1", "left2"] },
        { "Fungus3_13", ["left3", "left2", "left1", "right1", "bot1"] },
        { "Fungus3_21", ["right1", "top1"] },
        { "Fungus3_22", ["left1", "right1", "bot1"] },
        { "Fungus3_23", ["left1", "right1"] },
        { "Fungus3_23_boss", [] },
        { "Fungus3_24", ["left1", "right1", "top1"] },
        { "Fungus3_25", ["left1", "right1"] },
        { "Fungus3_25b", ["left1", "right1"] },
        { "Fungus3_26", ["left3", "right1", "left1", "top1", "left2"] },
        { "Fungus3_27", ["left1", "right1"] },
        { "Fungus3_28", ["right1"] },
        { "Fungus3_30", ["bot1"] },
        { "Fungus3_34", ["top1", "left1", "right1"] },
        { "Fungus3_35", ["right1"] },
        { "Fungus3_39", ["left1", "right1"] },
        { "Fungus3_40", ["door_stagExit", "right1", "top1"] },
        { "Fungus3_40_boss", [] },
        { "Fungus3_44", ["door1", "bot1", "right1"] },
        { "Fungus3_47", ["door1", "right1", "left1"] },
        { "Fungus3_48", ["door1", "right1", "right2", "bot1"] },
        { "Fungus3_49", ["right1"] },
        { "Fungus3_50", ["right1"] },
        { "Fungus3_archive", ["bot1", "left1"] },
        { "Fungus3_archive_02", ["door_dreamReturn", "top1"] },
        { "Fungus3_archive_02_boss", [] },
        { "Cliffs_01", ["right3", "right2", "right1", "right4"] },
        { "Cliffs_02", ["right1", "bot2", "left1", "door1", "bot1", "left2"] },
        { "Cliffs_02_boss", [] },
        { "Cliffs_03", ["right1", "door_stagExit"] },
        { "Cliffs_04", ["left1", "right1"] },
        { "Cliffs_05", ["left1"] },
        { "Cliffs_06", ["left1"] },
        { "RestingGrounds_02", ["right1", "top1", "left1", "bot1"] },
        { "RestingGrounds_02_boss", [] },
        { "RestingGrounds_04", ["right1", "left1"] },
        { "RestingGrounds_05", ["right2", "right1", "left1", "bot1", "left2", "left3"] },
        { "RestingGrounds_06", ["right1", "left1", "top1"] },
        { "RestingGrounds_07", ["door_dreamReturn", "right1"] },
        { "RestingGrounds_08", ["left1", "door_dreamReturn"] },
        { "RestingGrounds_09", ["door_stagExit", "left1"] },
        { "RestingGrounds_10", ["top2", "top1", "left1"] },
        { "RestingGrounds_12", ["bot1", "door_Mansion"] },
        { "RestingGrounds_17", ["right1"] },
        { "Mines_01", ["bot1", "left1"] },
        { "Mines_02", ["top2", "left1", "top1", "right1"] },
        { "Mines_03", ["bot1", "top1", "right1"] },
        { "Mines_04", ["left2", "right1", "left3", "top1", "left1"] },
        { "Mines_05", ["bot1", "left1", "left2", "right1", "top1"] },
        { "Mines_06", ["right1", "left1"] },
        { "Mines_07", ["right1", "left1"] },
        { "Mines_10", ["right1", "left1", "bot1"] },
        { "Mines_11", ["top1", "bot1", "right1"] },
        { "Mines_13", ["top1", "bot1", "right1"] },
        { "Mines_16", ["top1"] },
        { "Mines_17", ["right1", "left1"] },
        { "Mines_18", ["top1", "right1", "left1"] },
        { "Mines_18_boss", [] },
        { "Mines_19", ["right1", "left1"] },
        { "Mines_20", ["left3", "right2", "bot1", "left2", "left1", "right1"] },
        { "Mines_23", ["right1", "top1", "left1", "right2"] },
        { "Mines_24", ["left1"] },
        { "Mines_25", ["left1", "top1"] },
        { "Mines_28", ["bot1", "door1", "left1"] },
        { "Mines_29", ["right1", "right2", "left1"] },
        { "Mines_30", ["right1", "left1"] },
        { "Mines_31", ["left1"] },
        { "Mines_32", ["bot1"] },
        { "Mines_33", ["left1", "right1"] },
        { "Mines_34", ["left1", "bot2", "right1", "bot1"] },
        { "Mines_35", ["left1"] },
        { "Mines_36", ["right1"] },
        { "Mines_37", ["top1", "bot1"] },
        { "Deepnest_01", ["left1", "right1", "bot2", "bot1"] },
        { "Deepnest_01b", ["bot1", "top1", "right1", "right2", "top2"] },
        { "Deepnest_02", ["right1", "left1", "left2"] },
        { "Deepnest_03", ["left2", "top1", "left1", "right1"] },
        { "Deepnest_09", ["door_stagExit", "left1"] },
        { "Deepnest_10", ["door1", "right2", "right3", "right1", "door2"] },
        { "Deepnest_14", ["left1 (3)", "bot1", "left1 (1)", "right1", "left1 (2)", "bot2", "left1"] },
        { "Deepnest_16", ["bot1", "left1"] },
        { "Deepnest_17", ["top1", "left1", "bot1", "right1"] },
        { "Deepnest_26", ["bot1", "left1", "right1", "left2"] },
        { "Deepnest_26b", ["right2", "right1"] },
        { "Deepnest_30", ["right1", "top1", "left1"] },
        { "Deepnest_31", ["right2", "right1"] },
        { "Deepnest_32", ["left1"] },
        { "Deepnest_33", ["bot1", "top1", "top2"] },
        { "Deepnest_34", ["top1", "left1", "right1"] },
        { "Deepnest_35", ["top1", "left1", "bot1"] },
        { "Deepnest_36", ["left1"] },
        { "Deepnest_37", ["top1", "right1", "left1", "bot1"] },
        { "Deepnest_38", ["bot1"] },
        { "Deepnest_39", ["door1", "right1", "top1", "left1"] },
        { "Deepnest_40", ["right1"] },
        { "Deepnest_41", ["left2", "right1", "left1"] },
        { "Deepnest_42", ["bot1", "top1", "left1"] },
        { "Deepnest_43", ["bot1", "left1", "right1"] },
        { "Deepnest_44", ["top1"] },
        { "Deepnest_45_v02", ["left1"] },
        { "Deepnest_Spider_Town", ["left1", "door_dreamReturn"] },
        { "Room_spider_small", ["left1"] },
        { "Deepnest_East_01", ["top1", "right1", "bot1"] },
        { "Deepnest_East_02", ["right1", "bot2", "top1", "bot1"] },
        { "Deepnest_East_03", ["right2", "top2", "right1", "top1", "left2", "left1"] },
        { "Deepnest_East_04", ["right1", "right2", "left2", "left1"] },
        { "Deepnest_East_06", ["right1", "door1", "bot1", "top1", "left1"] },
        { "Deepnest_East_07", ["left1", "bot2", "right1", "bot1", "left2"] },
        { "Deepnest_East_08", ["right1", "top1"] },
        { "Deepnest_East_09", ["left1", "right1", "bot1"] },
        { "Deepnest_East_10", ["left1"] },
        { "Deepnest_East_11", ["left1", "top1", "bot1", "right1"] },
        { "Deepnest_East_12", ["right1", "door_cutsceneReturn", "left1"] },
        { "Deepnest_East_13", ["bot1"] },
        { "Deepnest_East_14", ["left1", "top2", "door1"] },
        { "Deepnest_East_14b", ["top1", "right1"] },
        { "Deepnest_East_15", ["left1"] },
        { "Deepnest_East_16", ["bot1", "left1"] },
        { "Deepnest_East_17", ["left1"] },
        { "Deepnest_East_18", ["right2", "top1", "bot1"] },
        { "Deepnest_East_Hornet", ["left1", "left2"] },
        { "Deepnest_East_Hornet_boss", [] },
        { "Room_Wyrm", ["right1"] },
        { "Abyss_01", ["left1", "right1", "right2", "left3", "left2"] },
        { "Abyss_02", ["right1", "bot1"] },
        { "Abyss_03", ["bot1", "door_tram", "door_tram_arrive", "bot2", "top1"] },
        { "Abyss_03_b", ["door_tram", "door_tram_arrive", "left1"] },
        { "Abyss_03_c", ["door_tram", "door_tram_arrive", "top1", "right1"] },
        { "Abyss_04", ["top1", "right1", "bot1", "left1"] },
        { "Abyss_05", ["door_dreamReturn_reality", "right1", "door_dreamReturn", "left1"] },
        { "Abyss_06_Core", ["left1 extra", "right2", "top1", "bot1", "left1", "door_dreamReturn", "left3"] },
        { "Abyss_08", ["right1"] },
        { "Abyss_09", ["right1", "right3", "right2", "left1"] },
        { "Abyss_10", ["left2", "left1"] },
        { "Abyss_12", ["right1"] },
        { "Abyss_15", ["top1", "door_dreamReturn"] },
        { "Abyss_16", ["right1", "left1"] },
        { "Abyss_17", ["top1"] },
        { "Abyss_18", ["left1", "right1"] },
        { "Abyss_19", ["bot2", "door_dreamReturn", "left1", "right1", "bot1"] },
        { "Abyss_20", ["top1", "top2"] },
        { "Abyss_21", ["right1"] },
        { "Abyss_22", ["door_stagExit", "left1"] },
        { "Abyss_Lighthouse_room", ["left1"] },
        { "Room_Queen", ["left1"] },
        { "Waterways_01", ["left1", "bot1", "right1", "top1"] },
        { "Waterways_02", ["top3", "top2", "top1", "bot2", "bot1"] },
        { "Waterways_03", ["left1"] },
        { "Waterways_04", ["left1", "right1", "left2", "bot1"] },
        { "Waterways_04b", ["left1", "right1", "right2"] },
        { "Waterways_05", ["right1", "bot1", "bot2"] },
        { "Waterways_05_boss", [] },
        { "Waterways_06", ["right1", "top1"] },
        { "Waterways_07", ["right1", "top1", "right2", "left1", "door1"] },
        { "Waterways_08", ["left1", "top1", "left2"] },
        { "Waterways_09", ["right1", "left1"] },
        { "Waterways_12", ["right1"] },
        { "Waterways_12_boss", [] },
        { "Waterways_13", ["left2", "left1"] },
        { "Waterways_14", ["bot1", "bot2"] },
        { "Waterways_15", ["top1", "door_dreamReturn"] },
        { "White_Palace_01", ["top1", "right1", "left1"] },
        { "White_Palace_02", ["left1"] },
        { "White_Palace_03_hub", ["left1", "right1", "bot1", "top1", "door1", "doorWarp", "left2"] },
        { "White_Palace_04", ["top1", "right2"] },
        { "White_Palace_05", ["right1", "left2", "right2", "left1"] },
        { "White_Palace_06", ["bot1", "top1", "door_dreamReturn", "left1"] },
        { "White_Palace_07", ["bot1", "top1"] },
        { "White_Palace_08", ["left1", "right1"] },
        { "White_Palace_09", ["right1"] },
        { "White_Palace_11", ["door2", "door1", "doorWarp"] },
        { "White_Palace_12", ["bot1", "right1"] },
        { "White_Palace_13", ["right1", "left2", "left3", "left1"] },
        { "White_Palace_14", ["right1", "bot1"] },
        { "White_Palace_15", ["right2", "right1", "left1"] },
        { "White_Palace_16", ["left1", "left2"] },
        { "White_Palace_17", ["right1", "bot1"] },
        { "White_Palace_18", ["right1", "top1"] },
        { "White_Palace_19", ["top1", "left1"] },
        { "White_Palace_20", ["bot1"] },
        { "Hive_01", ["right2", "left1", "right1"] },
        { "Hive_02", ["left2", "left3", "left1"] },
        { "Hive_03", ["top1", "right1", "bot1"] },
        { "Hive_03_c", ["left1", "top1", "right2", "right3"] },
        { "Hive_04", ["left2", "right1", "left1"] },
        { "Hive_05", ["left1"] },
        { "Grimm_Divine", ["left1"] },
        { "Grimm_Main_Tent", ["left1", "door_dreamReturn"] },
        { "Grimm_Main_Tent_boss", [] },
        { "Grimm_Nightmare", ["door1"] },
        { "Dream_Nailcollection", ["door_dreamReturn4", "door_dreamReturn2", "door_dreamReturn", "door_dreamReturn3"] },
        { "Dream_01_False_Knight", ["door1"] },
        { "Dream_02_Mage_Lord", ["door1"] },
        { "Dream_03_Infected_Knight", ["door1"] },
        { "Dream_04_White_Defender", ["door1"] },
        { "Dream_Mighty_Zote", ["door1"] },
        { "Dream_Guardian_Hegemol", ["door1"] },
        { "Dream_Guardian_Lurien", ["door1"] },
        { "Dream_Guardian_Monomon", ["door1"] },
        { "Cutscene_Boss_Door", ["door1"] },
        { "Dream_Backer_Shrine", ["door2", "door1"] },
        { "Dream_Room_Believer_Shrine", ["left1"] },
        { "Dream_Abyss", ["door1"] },
        { "Dream_Final_Boss", ["door1"] },
        { "Room_Final_Boss_Atrium", ["left1", "right1"] },
        { "Room_Final_Boss_Core", ["left1"] },
        { "Cinematic_Ending_A", [] },
        { "Cinematic_Ending_B", [] },
        { "Cinematic_Ending_C", [] },
        { "Cinematic_Ending_D", [] },
        { "Cinematic_Ending_E", [] },
        { "End_Credits", [] },
        { "Cinematic_MrMushroom", [] },
        { "Menu_Credits", [] },
        { "End_Game_Completion", [] },
        { "PermaDeath", [] },
        { "_test_cocoon_2", ["left1"] },
        { "PermaDeath_Unlock", [] },
        { "_test_cocoon_1", ["right1"] },
        { "GG_Waterways", ["door1", "right1", "door_dreamReturn"] }, {
            "GG_Atrium",
            [
                "door_dreamEnter_ReturnGGMode", "Door_Workshop", "top1", "door_dreamEnter", "top2",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door1_blueRoom",
            ]
        },
        { "GG_Broken_Vessel", ["door_dreamEnter"] },
        { "GG_Brooding_Mawlek", ["door_dreamEnter"] },
        { "GG_Collector", ["door_dreamEnter"] },
        { "GG_Crystal_Guardian", ["door_dreamEnter"] },
        { "GG_Crystal_Guardian_2", ["door_dreamEnter"] },
        { "GG_Dung_Defender", ["door_dreamEnter"] },
        { "GG_Failed_Champion", ["door_dreamEnter"] },
        { "GG_False_Knight", ["door_dreamEnter"] },
        { "GG_Flukemarm", ["door_dreamEnter"] },
        { "GG_Ghost_Galien", ["door_dreamEnter"] },
        { "GG_Ghost_Gorb", ["door_dreamEnter"] },
        { "GG_Ghost_Hu", ["door_dreamEnter"] },
        { "GG_Ghost_Markoth", ["door_dreamEnter"] },
        { "GG_Ghost_Marmu", ["door_dreamEnter"] },
        { "GG_Ghost_No_Eyes", ["door_dreamEnter"] },
        { "GG_Ghost_Xero", ["door_dreamEnter"] },
        { "GG_God_Tamer", ["door_dreamEnter"] },
        { "GG_Grey_Prince_Zote", ["door_dreamEnter"] },
        { "GG_Grimm", ["door_dreamEnter"] },
        { "GG_Grimm_Nightmare", ["door_dreamEnter"] },
        { "GG_Gruz_Mother", ["door_dreamEnter"] },
        { "GG_Hive_Knight", ["door_dreamEnter"] },
        { "GG_Hollow_Knight", ["door_dreamEnter"] },
        { "GG_Hornet_1", ["door_dreamEnter"] },
        { "GG_Hornet_2", ["door_dreamEnter"] },
        { "GG_Lost_Kin", ["door_dreamEnter"] },
        { "GG_Lurker", ["left1"] },
        { "GG_Mantis_Lords", ["door_dreamEnter"] },
        { "GG_Mega_Moss_Charger", ["door_dreamEnter"] },
        { "GG_Nailmasters", ["door_dreamEnter"] },
        { "GG_Nosk", ["door_dreamEnter"] },
        { "GG_Oblobbles", ["door_dreamEnter"] },
        { "GG_Painter", ["door_dreamEnter"] },
        { "GG_Pipeway", ["left1", "right1"] },
        { "GG_Radiance", ["door_dreamEnter"] },
        { "GG_Sly", ["door_dreamEnter"] },
        { "GG_Soul_Master", ["door_dreamEnter"] },
        { "GG_Soul_Tyrant", ["door_dreamEnter"] },
        { "GG_Spa", ["right1", "door_dreamEnter"] },
        { "GG_Traitor_Lord", ["door_dreamEnter"] },
        { "GG_Unlock", [] },
        { "GG_Uumuu", ["door_dreamEnter"] },
        { "GG_Vengefly", ["door_dreamEnter"] },
        { "GG_Watcher_Knights", ["door_dreamEnter"] },
        { "GG_White_Defender", ["door_dreamEnter"] }, {
            "GG_Workshop",
            [
                "left1", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG", "door_dreamReturnGG",
                "door_dreamReturnGG",
            ]
        },
        { "Room_GG_Shortcut", ["left1", "top1"] },
        { "GG_End_Sequence", [] }, {
            "GG_Atrium_Roof",
            ["bot1", "door_Land_of_Storms_return", "bot2", "door_Land_of_Storms", "door_dreamReturnGG"]
        },
        { "GG_Blue_Room", ["left1"] },
        { "GG_Engine", ["right1", "door_dreamEnter"] },
        { "GG_Engine_Prime", ["right1", "door_dreamEnter"] },
        { "GG_Engine_Root", ["right1", "door_dreamEnter"] },
        { "GG_Mage_Knight", ["door_dreamEnter"] },
        { "GG_Vengefly_V", ["door_dreamEnter"] },
        { "GG_Entrance_Cutscene", [] },
        { "GG_Mighty_Zote", ["door_dreamEnter"] },
        { "GG_Land_of_Storms", ["door1"] },
        { "GG_Boss_Door_Entrance", [] },
        { "GG_Gruz_Mother_V", ["door_dreamEnter"] },
        { "GG_Brooding_Mawlek_V", ["door_dreamEnter"] },
        { "GG_Mantis_Lords_V", ["door_dreamEnter"] },
        { "GG_Nosk_Hornet", ["door_dreamEnter"] },
        { "GG_Uumuu_V", ["door_dreamEnter"] },
        { "GG_Ghost_Gorb_V", ["door_dreamEnter"] },
        { "GG_Ghost_Markoth_V", ["door_dreamEnter"] },
        { "GG_Ghost_Marmu_V", ["door_dreamEnter"] },
        { "GG_Ghost_No_Eyes_V", ["door_dreamEnter"] },
        { "GG_Ghost_Xero_V", ["door_dreamEnter"] },
        { "GG_Mage_Knight_V", ["door_dreamEnter"] },
        { "GG_Collector_V", ["door_dreamEnter"] },
        { "GG_Nosk_V", ["door_dreamEnter"] },
        { "GG_Wyrm", ["right1", "door_dreamEnter"] },
        { "GG_Unn", ["right1", "door_dreamEnter"] },
        { "GG_Door_5_Finale", [] },
        { "GG_Unlock_Wastes", ["door_dreamEnter"] },
    };

    private class LoadMeta : ITasCommandMeta {
        public override string Insert =>
            $"load{CommandInfo.Separator}[0;Scene]{CommandInfo.Separator}[1;transition]";

        public override bool HasArguments => true;

        public override IEnumerator<CommandAutoCompleteEntry> GetAutoCompleteEntries(string[] args, string filePath,
            int fileLine) {
            if (!InGame()) yield break;

            if (args.Length == 1) {
                foreach (var sceneName in sceneTransitions.Keys) {
                    yield return new CommandAutoCompleteEntry { Name = sceneName, IsDone = true };
                }
            } else if (args.Length == 2) {
                var sceneName = args[0];
                Log.Info(sceneName);
                if (sceneTransitions.TryGetValue(sceneName, out var transitions)) {
                    foreach (var transitionName in transitions) {
                        yield return new CommandAutoCompleteEntry { Name = transitionName, IsDone = true };
                    }
                }
            }
        }
    }

    private static bool InGame() => true;

    public static bool IsLoading = false;

    [TasCommand("load", MetaDataProvider = typeof(LoadMeta))]
    private static void Load(CommandLine commandLine, int studioLine, string filePath, int fileLine) {
        IsLoading = true;
        TasTracerState.AddFrameHistory("Executing load command");

        if (commandLine.Arguments.Length != 2) {
            AbortTas($"Invalid number of arguments in load command: '{commandLine.OriginalText}'.");
            return;
        }

        var scene = commandLine.Arguments[0];
        var gateName = commandLine.Arguments[1];

        if (!InGame()) {
            AbortTas("Attempted to start TAS outside of a level");
            return;
        }

        Normalize();

        var gameManager = GameManager.instance;
        gameManager.entryGateName = gateName;
        gameManager.LoadScene(scene);

        IsLoading = false;
    }

    private static void Normalize() {
        Random.InitState(0);

        if (HeroController.SilentInstance is { } player) {
            player.cState.Reset();
            player.transform.position = new Vector3(0, 0, 0.004f);
            player.InvokeMethod("ResetMotion");
            player.InvokeMethod("ResetInput");
            player.InvokeMethod("ResetLook");
            player.InvokeMethod("ResetAttacks");
            player.touchingWallL = false;
            player.touchingWallR = false;
        }
    }
}
